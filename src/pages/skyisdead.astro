---
import Layout from "../layouts/Layout.astro";
import CharacerCard from "../components/CharacerCard.astro";
import brickwall_bg from "../assets/images/backgrounds/brickwall1.jpeg";
import { getImage } from "astro:assets";

const optimizedBackgroundImage = await getImage({ src: brickwall_bg });
const optimizedBgURL = optimizedBackgroundImage.src;

const img_metadata = await Astro.glob(
  "/src/assets/images/SkyIsDead/characters/*.{jpeg,jpg,png}",
);

const metadata: ImageMetadata[] = img_metadata.map(
  (file: Record<string, any>) => file.default,
);

const card_width = (100 / metadata.length).toString() + "%";
const img_classname = "character-card";
---

<Layout title="Sky Is Dead by Victor PÃ©rez Brotons">
  <div class="bg-container">
    <!-- <Image
      class="bg"
      src={brickwall_bg}
      alt=""
      widths={[240, 540, 720, brickwall_bg.width]}
      sizes={`(max-width: 360px) 360px, (max-width: 720px) 720px, (max-width: 1600px) 1200px, ${brickwall_bg.width}px`}
    /> -->
  </div>

  <div class="card-flex-container">
    {
      metadata.map((image: ImageMetadata) => (
        <CharacerCard img={image} width={card_width} />
      ))
    }
  </div>
</Layout>

<!-- <style> -->
<style define:vars={{ bgimage: `url(${optimizedBgURL})` }}>
  .bg-container {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: black;

    background-image: var(--bgimage);
    background-size: cover;
    background-position: top;
    background-repeat: no-repeat;
  }

  .bg {
    position: fixed;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top;
  }

  .card-flex-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    align-items: center;
    height: 100%;
    width: 100%;
    gap: 2rem;
    padding: 5rem;
  }
</style>
